@if (locations$ | async; as locations) {
<div class="google-map-container">
  <mat-drawer-container class="drawer-container" autosize #drawer>
    <!-- Side content -->
    <mat-drawer #drawer class="side-content" mode="side">
      <div class="header">
        <h2>Location information</h2>

        <!-- Close button -->
        <button
          type="button"
          mat-mini-fab
          color="primary"
          (click)="closeDrawerAndTooltip()"
        >
          <mat-icon fontIcon="close" aria-label="Close side content" />
        </button>
        <!-- /Close button -->
      </div>

      <!-- Content -->
      <div class="content">
        <!-- Active location info -->
        @for (prop of locations[activeLocationIndex!] | keyvalue: originalOrder;
        track $index) {
        <div *ngIf="prop.key !== 'id'" class="location-info-row">
          <div class="key">{{ prop.key }}:</div>
          <div class="value">{{ prop.value | formatValue }}</div>
        </div>
        }
        <!-- Active location info -->
      </div>

      <!-- /Content -->
    </mat-drawer>
    <!-- /Side content -->

    <!-- Main content -->
    <div class="main-content">
      <!-- Map -->
      <google-map height="100%" width="100%" [zoom]="5" [options]="mapOptions">
        <!-- Marker clusterer -->
        <map-marker-clusterer [imagePath]="clusterImagePath">
          <!-- Markers -->
          @for (location of locations; track idx; let idx = $index) {
          <map-marker
            #marker="mapMarker"
            [position]="{ lat: location.lat, lng: location.lng }"
            [icon]="
              idx === this.activeLocationIndex
                ? activeMarkerIcon
                : defaultMarkerIcon
            "
            (mapClick)="markerClicked(marker, idx)"
          />
          }
          <!-- /Markers -->
        </map-marker-clusterer>
        <!-- /Marker clusterer -->

        <!-- Marker tooltip -->
        <map-info-window (closeclick)="closeDrawerAndTooltip()">
          <span>{{ locations[activeLocationIndex!]?.name }}</span>
        </map-info-window>
        <!-- /Marker tooltip -->
      </google-map>
      <!-- /Map -->
    </div>
    <!-- /Main content -->
  </mat-drawer-container>
</div>
}
